# ============================================================================
# PROJET VERTIFLOW - Agriculture Verticale Intelligente
# ============================================================================
# Date de cr√©ation    : 25/12/2025
# √âquipe              : VertiFlow Core Team
#
# Membres:
#   üßô‚Äç‚ôÇÔ∏è @Mounir       - Architecte & Scientifique
#   üèóÔ∏è @Imrane       - DevOps & Infrastructure
#   üêç @Mouhammed    - Data Engineer & Analyste ETL
#   üß¨ @Asama        - Biologiste & Domain Expert
#   ‚öñÔ∏è @MrZakaria    - Encadrant & Architecte Data
#
# ----------------------------------------------------------------------------
# FICHIER: nifi_pipeline_dev.yaml
# DESCRIPTION: Configuration NiFi pour l'environnement de D√âVELOPPEMENT
#              Param√®tres souples, logs verbeux, mocks activ√©s.
#
# D√©velopp√© par        : @Mouhammed
# Ticket(s) associ√©(s): TICKET-010
# Sprint              : Semaine 2 - Phase ETL
#
# ----------------------------------------------------------------------------
# ¬© 2025 VertiFlow Core Team
# Initiative Nationale Marocaine JobInTech - YNOV Maroc Campus
# ============================================================================

environment: development
version: 1.0.0-dev

# --- Z1: COLLECTION (Ingestion) ---
mqtt:
  broker_uri: tcp://mosquitto:1883  # Interne Docker
  client_id: nifi_dev_consumer
  topic_filter: vertiflow/telemetry/#
  qos: 0                            # QoS 0 pour la vitesse en dev
  max_queue_size: 100

api_nasa:
  url: https://power.larc.nasa.gov/api/temporal/daily/point
  mock_enabled: false               # Mettre √† true pour simuler sans internet
  scheduling: "5 min"               # Fr√©quence rapide pour tester

# --- Z2: ENRICHISSEMENT ---
enrichment:
  cache_service: "DistributedMapCacheClientService"
  lookup_db: "MongoDB"
  farm_id_default: "VERT-DEV-01"    # ID de ferme par d√©faut

# --- Z3: QUALIT√â & TRA√áABILIT√â ---
validation:
  schema_path: /opt/nifi/schemas/telemetry_v3.json
  strict_mode: false                # Ne rejette pas les champs inconnus
  z_score_threshold: 5.0            # Seuil large pour accepter les tests manuels

# --- Z3.5: BLOCKCHAIN HASH (Int√©grit√© des donn√©es) ---
blockchain:
  enabled: true
  processor_script: /opt/nifi/scripts/blockchain_hash_processor.py
  hash_algorithm: SHA-256
  hmac_enabled: true                # Active audit_trail_signature
  # Position: APR√àS validation, AVANT publication Kafka/ClickHouse

# --- Z4: PUBLICATION ---
kafka:
  bootstrap_servers: kafka:29092    # Port interne Docker
  topic_name: basil_telemetry_dev
  delivery_guarantee: "1"           # Leader only (Rapide)
  compression: "none"               # Pas de compression pour debugger

clickhouse:
  connection_url: jdbc:clickhouse://clickhouse:8123/vertiflow
  batch_size: 10                    # Petits lots pour voir les donn√©es vite
  table_name: basil_ultimate_realtime

# --- GESTION ERREURS ---
dlq:
  enabled: true
  path: /opt/nifi/data/dlq_dev
  auto_retry: true                  # R√©essaie automatiquement en dev