# ============================================================================
# PROJET VERTIFLOW - Agriculture Verticale Intelligente
# ============================================================================
# Date de cr√©ation    : 25/12/2025
# √âquipe              : VertiFlow Core Team
#
# Membres:
#   üßô‚Äç‚ôÇÔ∏è @Mounir       - Architecte & Scientifique
#   üèóÔ∏è @Imrane       - DevOps & Infrastructure
#   üêç @Mouhammed    - Data Engineer & Analyste ETL
#   üß¨ @Asama        - Biologiste & Domain Expert
#   ‚öñÔ∏è @MrZakaria    - Encadrant & Architecte Data
#
# ----------------------------------------------------------------------------
# FICHIER: prometheus.yml
# DESCRIPTION: Configuration principale du serveur Prometheus.
#              D√©finit les cibles de scraping pour l'observabilit√©.
#
# D√©velopp√© par        : @Imrane
# Ticket(s) associ√©(s): TICKET-060
# Sprint              : Semaine 6 - Phase Monitoring
#
# ----------------------------------------------------------------------------
# ¬© 2025 VertiFlow Core Team
# Initiative Nationale Marocaine JobInTech - YNOV Maroc Campus
# ============================================================================

global:
  scrape_interval: 15s     # Fr√©quence de collecte par d√©faut
  evaluation_interval: 15s # Fr√©quence d'√©valuation des r√®gles d'alerte
  external_labels:
    cluster: 'vertiflow-prod'
    dc: 'casablanca-ynov'

# R√®gles d'alerte (Fichier s√©par√© √† pr√©voir si besoin)
rule_files:
  # - "alert_rules.yml"

scrape_configs:
  # 1. Auto-surveillance Prometheus
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # 2. M√©triques Syst√®me (CPU, RAM, Disque de l'h√¥te Docker)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  # 3. M√©triques ClickHouse (Performance Requ√™tes, Stockage)
  - job_name: 'clickhouse'
    static_configs:
      - targets: ['clickhouse:9363'] # Port metrics natif ClickHouse

  # 4. M√©triques MongoDB (via mongodb-exporter)
  - job_name: 'mongodb'
    static_configs:
      - targets: ['mongodb_exporter:9216'] # N√©cessite un conteneur exporter

  # 5. M√©triques Kafka (via JMX Exporter)
  - job_name: 'kafka'
    static_configs:
      - targets: ['kafka:7071'] # Port JMX configur√© dans docker-compose

  # 6. M√©triques NiFi (via Reporting Task Prometheus)
  # N√©cessite d'activer le "PrometheusReportingTask" dans NiFi sur le port 9092
  - job_name: 'nifi'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['nifi:9092']

  # 7. M√©triques Docker (√âtat des conteneurs)
  - job_name: 'docker'
    static_configs:
      - targets: ['host.docker.internal:9323'] # N√©cessite config daemon.json