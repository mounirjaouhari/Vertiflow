{
  "annotations": {
    "list": []
  },
  "description": "Tableau de bord complet des mod√®les d'Intelligence Artificielle VertiFlow. Visualise en temps r√©el les pr√©dictions de rendement (Oracle A9), les estimations de r√©colte bas√©es sur le mod√®le scientifique GDD+Gompertz (Harvest A9b), la classification qualit√© (Classifier A10) et l'optimisation des recettes agronomiques (Cortex A11).",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "type": "text",
      "title": "üß† VertiFlow ML Engine - Syst√®me d'Intelligence Agronomique",
      "description": "Vue d'ensemble compl√®te du syst√®me de Machine Learning VertiFlow pour l'agriculture verticale intelligente",
      "gridPos": { "h": 5, "w": 24, "x": 0, "y": 0 },
      "options": {
        "mode": "markdown",
        "content": "## üå± Intelligence Artificielle pour l'Agriculture Verticale\n\nCe tableau de bord pr√©sente les **4 mod√®les ML** actifs de la plateforme VertiFlow :\n\n| Mod√®le | Algorithme | Fonction | R√©f√©rences Scientifiques |\n|--------|-----------|----------|-------------------------|\n| **A9 - Oracle** | RandomForest Regressor | Pr√©diction du rendement (kg/m¬≤) | Breiman (2001) |\n| **A9b - Harvest** | GDD + Gompertz | Pr√©diction date de r√©colte | McMaster & Wilhelm (1997), Zwietering (1990) |\n| **A10 - Classifier** | Gradient Boosting | Classification qualit√© (Premium/Standard/Rejet) | Friedman (2001) |\n| **A11 - Cortex** | Scipy L-BFGS-B | Optimisation des recettes agronomiques | Byrd et al. (1995) |\n\n**Param√®tres Basilic (A9b):** T_base=10¬∞C | GDD_r√©colte=550 | VPD_optimal=0.8-1.2 kPa | DLI_optimal=12-17 mol/m¬≤/jour"
      }
    },
    {
      "type": "row",
      "title": "üìä Vue Globale - Activit√© des 4 Mod√®les ML (24h)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "üîÆ Oracle A9",
      "description": "Nombre de pr√©dictions de rendement. Le mod√®le RandomForest analyse temp√©rature, humidit√©, DLI, EC et pH pour estimer le rendement en kg/m¬≤. Performance: R¬≤ > 0.87",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 6 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT count() FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR AND predicted_yield_kg_m2 > 0",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "displayName": "Pr√©dictions Rendement",
          "color": { "fixedColor": "green", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "üå°Ô∏è Harvest A9b",
      "description": "Pr√©dictions de date de r√©colte bas√©es sur le mod√®le GDD (Growing Degree Days) + Gompertz. Calcule l'accumulation thermique et estime les jours restants. R√©f√©rences: McMaster & Wilhelm (1997)",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 6 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT count() FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "displayName": "Pr√©dictions R√©colte",
          "color": { "fixedColor": "orange", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "orange", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "üéØ Classifier A10",
      "description": "Classifications de qualit√©. Le mod√®le Gradient Boosting √©value chaque lot selon le score de sant√©, VPD, DLI et EC pour attribuer un grade: Premium (>85%), Standard (60-85%), Rejet (<60%). Pr√©cision: >92%",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 6 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT count() FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "displayName": "Classifications",
          "color": { "fixedColor": "blue", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "üß¨ Cortex A11",
      "description": "Optimisations de recettes agronomiques. L'algorithme L-BFGS-B optimise simultan√©ment EC (1.0-2.5), pH (5.5-6.5), temp√©rature (18-28¬∞C) et DLI (12-20) pour maximiser le rendement pr√©dit.",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 6 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT count() FROM vertiflow.ml_predictions WHERE model_name = 'Cortex_A11' AND timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "displayName": "Optimisations",
          "color": { "fixedColor": "purple", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "purple", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "row",
      "title": "ü§ñ A9 - ORACLE : Pr√©diction de Rendement (RandomForest)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 10 },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "üåø Rendement Moyen Pr√©dit",
      "description": "Moyenne des rendements pr√©dits par le mod√®le Oracle sur les derni√®res 24h. Le mod√®le RandomForest utilise 5 features: temp√©rature, humidit√©, DLI, EC et pH. Objectif: >3.5 kg/m¬≤ pour le basilic.",
      "gridPos": { "h": 5, "w": 6, "x": 0, "y": 11 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(predicted_yield_kg_m2), 2) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR AND predicted_yield_kg_m2 > 0",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "kg/m¬≤",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 2 },
              { "color": "green", "value": 3.5 }
            ]
          },
          "color": { "mode": "thresholds" }
        }
      },
      "options": { "colorMode": "value", "graphMode": "area" }
    },
    {
      "type": "gauge",
      "title": "üìà Rendement Maximum",
      "description": "Rendement maximum pr√©dit sur 24h. Indique le potentiel de production dans les meilleures conditions. Seuils: <2 (rouge), 2-3 (jaune), 3-4 (orange), >4 (vert)",
      "gridPos": { "h": 5, "w": 6, "x": 6, "y": 11 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(max(predicted_yield_kg_m2), 2) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "kg/m¬≤",
          "min": 0,
          "max": 6,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "orange", "value": 2 },
              { "color": "yellow", "value": 3 },
              { "color": "green", "value": 4 }
            ]
          }
        }
      },
      "options": { "orientation": "auto", "showThresholdLabels": true, "showThresholdMarkers": true }
    },
    {
      "type": "timeseries",
      "title": "üìä √âvolution du Rendement Pr√©dit par Zone",
      "description": "Courbe temporelle des pr√©dictions de rendement par lot de culture. Permet de suivre l'√©volution des performances et d√©tecter les tendances. Agr√©gation horaire sur 7 jours.",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 11 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT toStartOfHour(timestamp) as time, avg(predicted_yield_kg_m2) as rendement_predit, batch_id FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 7 DAY AND predicted_yield_kg_m2 > 0 GROUP BY time, batch_id ORDER BY time",
          "refId": "A",
          "format": 0
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "kg/m¬≤",
          "displayName": "Rendement",
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "showPoints": "auto"
          },
          "color": { "mode": "palette-classic" }
        }
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"] },
        "tooltip": { "mode": "multi", "sort": "desc" }
      }
    },
    {
      "type": "stat",
      "title": "üìã Total Pr√©dictions",
      "description": "Nombre total de pr√©dictions de rendement g√©n√©r√©es aujourd'hui par le mod√®le Oracle A9.",
      "gridPos": { "h": 3, "w": 6, "x": 0, "y": 16 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT count() FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= today() AND predicted_yield_kg_m2 > 0",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "displayName": "Aujourd'hui",
          "color": { "fixedColor": "blue", "mode": "fixed" }
        }
      },
      "options": { "colorMode": "value", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "üéØ Pr√©cision Mod√®le",
      "description": "Stabilit√© des pr√©dictions calcul√©e comme 100 - (√©cart-type / moyenne * 100). Plus la valeur est √©lev√©e, plus les pr√©dictions sont coh√©rentes.",
      "gridPos": { "h": 3, "w": 6, "x": 6, "y": 16 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(100 - (stddevPop(predicted_yield_kg_m2) / avg(predicted_yield_kg_m2) * 100), 1) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR AND predicted_yield_kg_m2 > 0",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "displayName": "Stabilit√©",
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 70 },
              { "color": "green", "value": 85 }
            ]
          }
        }
      },
      "options": { "colorMode": "value", "graphMode": "area" }
    },
    {
      "type": "row",
      "title": "üå°Ô∏è A9b - HARVEST PREDICTOR : Pr√©diction de R√©colte (GDD + Gompertz)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 19 },
      "collapsed": false
    },
    {
      "type": "text",
      "title": "üìö Mod√®le Scientifique GDD",
      "description": "Explication du mod√®le Growing Degree Days",
      "gridPos": { "h": 4, "w": 8, "x": 0, "y": 20 },
      "options": {
        "mode": "markdown",
        "content": "### Calcul GDD (McMaster & Wilhelm 1997)\n```\nGDD = max(0, T_moyenne - T_base)\n```\n- **T_base** = 10¬∞C (basilic)\n- **GDD r√©colte** = 550 degr√©s-jours\n- **Stades**: SEEDLING (<100) ‚Üí VEGETATIVE (100-400) ‚Üí PRE_HARVEST (400-500) ‚Üí READY (‚â•500)"
      }
    },
    {
      "type": "gauge",
      "title": "üå°Ô∏è GDD Accumul√©s (Moyenne)",
      "description": "Degr√©s-jours de croissance accumul√©s. Le basilic n√©cessite environ 550 GDD pour atteindre la maturit√© de r√©colte. Formule: GDD = Œ£ max(0, T_moy - 10¬∞C)",
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 20 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(gdd_accumulated), 0) FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 1 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "¬∞C¬∑j",
          "min": 0,
          "max": 550,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "blue", "value": null },
              { "color": "green", "value": 100 },
              { "color": "yellow", "value": 400 },
              { "color": "orange", "value": 500 }
            ]
          }
        }
      },
      "options": { "orientation": "auto", "showThresholdLabels": true, "showThresholdMarkers": true }
    },
    {
      "type": "stat",
      "title": "üìÖ Jours Restants",
      "description": "Nombre de jours estim√©s avant la r√©colte optimale. Calcul√© en fonction du GDD accumul√© et du taux d'accumulation moyen journalier.",
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 20 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(days_to_harvest), 0) FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 1 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "jours",
          "displayName": "Avant R√©colte",
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 7 },
              { "color": "orange", "value": 21 },
              { "color": "blue", "value": 35 }
            ]
          }
        }
      },
      "options": { "colorMode": "value", "graphMode": "none" }
    },
    {
      "type": "stat",
      "title": "üåø Biomasse Estim√©e",
      "description": "Biomasse actuelle estim√©e par le mod√®le Gompertz. Courbe de croissance sigmo√Ødale bas√©e sur: B(t) = B_max * exp(-exp(-k*(GDD-GDD_inflexion))). R√©f√©rence: Zwietering et al. (1990)",
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 20 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(biomass_estimated_g), 1) FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 1 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "g",
          "displayName": "Par Plant",
          "thresholds": {
            "steps": [
              { "color": "blue", "value": null },
              { "color": "green", "value": 20 },
              { "color": "yellow", "value": 60 },
              { "color": "orange", "value": 100 }
            ]
          }
        }
      },
      "options": { "colorMode": "value", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "üí® VPD Moyen",
      "description": "D√©ficit de Pression de Vapeur (kPa). Calcul√© avec l'√©quation de Tetens (1930). Optimal pour basilic: 0.8-1.2 kPa. VPD = e_sat(T) * (1 - HR/100)",
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 20 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(vpd_kpa), 2) FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 1 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "kPa",
          "displayName": "VPD",
          "thresholds": {
            "steps": [
              { "color": "blue", "value": null },
              { "color": "green", "value": 0.8 },
              { "color": "yellow", "value": 1.2 },
              { "color": "red", "value": 1.5 }
            ]
          }
        }
      },
      "options": { "colorMode": "value", "graphMode": "none" }
    },
    {
      "type": "table",
      "title": "üìä Pr√©dictions de R√©colte par Zone",
      "description": "Tableau d√©taill√© des pr√©dictions de r√©colte pour chaque zone de culture. Inclut: GDD accumul√©s, jours restants, date pr√©vue, biomasse, stade de croissance, VPD, DLI et facteur de stress.",
      "gridPos": { "h": 8, "w": 16, "x": 0, "y": 24 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT zone as Zone, round(gdd_accumulated, 0) as GDD, round(days_to_harvest, 0) as Jours_Restants, predicted_harvest_date as Date_Recolte, round(biomass_estimated_g, 1) as Biomasse_g, growth_stage as Stade, round(vpd_kpa, 2) as VPD_kPa, round(dli_mol, 1) as DLI, round(stress_factor, 2) as Stress, round(confidence * 100, 0) as Confiance_pct FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 2 HOUR ORDER BY timestamp DESC LIMIT 20",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "align": "center" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "GDD" }, "properties": [{ "id": "unit", "value": "¬∞C¬∑j" }] },
          { "matcher": { "id": "byName", "options": "Biomasse_g" }, "properties": [{ "id": "unit", "value": "g" }] },
          { "matcher": { "id": "byName", "options": "Confiance_pct" }, "properties": [{ "id": "unit", "value": "percent" }] },
          { "matcher": { "id": "byName", "options": "Stade" }, "properties": [{ "id": "custom.cellOptions", "value": { "type": "color-text" } }, { "id": "mappings", "value": [{ "type": "value", "options": { "SEEDLING": { "color": "blue", "text": "üå± Semis" }, "VEGETATIVE": { "color": "green", "text": "üåø V√©g√©tatif" }, "PRE_HARVEST": { "color": "yellow", "text": "üåæ Pr√©-r√©colte" }, "READY": { "color": "orange", "text": "‚úÇÔ∏è Pr√™t" } } }] }] },
          { "matcher": { "id": "byName", "options": "Stress" }, "properties": [{ "id": "custom.cellOptions", "value": { "type": "color-background", "mode": "gradient" } }, { "id": "thresholds", "value": { "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 0.7 }, { "color": "red", "value": 0.5 }] } }] }
        ]
      },
      "options": { "showHeader": true, "footer": { "show": false } }
    },
    {
      "type": "timeseries",
      "title": "üìà √âvolution GDD et Biomasse",
      "description": "Suivi de l'accumulation thermique (GDD) et de la croissance de biomasse dans le temps. Permet de visualiser la progression vers la maturit√© de r√©colte.",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 24 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT toStartOfHour(timestamp) as time, zone, avg(gdd_accumulated) as GDD, avg(biomass_estimated_g) as Biomasse FROM vertiflow.harvest_predictions WHERE timestamp >= now() - INTERVAL 7 DAY GROUP BY time, zone ORDER BY time",
          "refId": "A",
          "format": 0
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "lineWidth": 2, "fillOpacity": 15 },
          "color": { "mode": "palette-classic" }
        },
        "overrides": [
          { "matcher": { "id": "byRegexp", "options": "GDD.*" }, "properties": [{ "id": "unit", "value": "¬∞C¬∑j" }, { "id": "custom.axisPlacement", "value": "left" }] },
          { "matcher": { "id": "byRegexp", "options": "Biomasse.*" }, "properties": [{ "id": "unit", "value": "g" }, { "id": "custom.axisPlacement", "value": "right" }] }
        ]
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["last"] }
      }
    },
    {
      "type": "row",
      "title": "üéØ A10 - CLASSIFIER : Classification Qualit√© (Gradient Boosting)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 32 },
      "collapsed": false
    },
    {
      "type": "piechart",
      "title": "ü•á Distribution des Grades de Qualit√©",
      "description": "R√©partition des classifications de qualit√© sur 24h. PREMIUM: produit d'excellence (>85% score sant√©), STANDARD: qualit√© acceptable (60-85%), REJECT: non conforme (<60%). Bas√© sur VPD, DLI, EC et temp√©rature.",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 33 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT toString(predicted_quality_grade) as Grade, count() as Nombre FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 24 HOUR GROUP BY predicted_quality_grade ORDER BY Nombre DESC",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" }
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "PREMIUM" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "STANDARD" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "REJECT" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "right", "values": ["value", "percent"] },
        "pieType": "donut",
        "tooltip": { "mode": "single" },
        "reduceOptions": { "calcs": ["sum"] }
      }
    },
    {
      "type": "stat",
      "title": "üèÜ Premium",
      "description": "Pourcentage de lots class√©s PREMIUM. Crit√®res: score sant√© >85%, VPD 0.8-1.2 kPa, DLI 12-17 mol/m¬≤/jour, EC 1.2-2.0 mS/cm. Objectif: >70%",
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 33 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(countIf(predicted_quality_grade = 'PREMIUM') * 100.0 / count(), 1) FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "displayName": "Excellence",
          "color": { "fixedColor": "green", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "üì¶ Standard",
      "description": "Pourcentage de lots class√©s STANDARD. Qualit√© commerciale acceptable mais perfectible. Score sant√© entre 60% et 85%.",
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 33 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(countIf(predicted_quality_grade = 'STANDARD') * 100.0 / count(), 1) FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "displayName": "Acceptable",
          "color": { "fixedColor": "yellow", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "yellow", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "stat",
      "title": "‚ö†Ô∏è Rejet",
      "description": "Pourcentage de lots class√©s REJECT. Non conforme aux standards de qualit√©. N√©cessite une analyse des causes (stress hydrique, maladies, carences). Objectif: <5%",
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 33 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(countIf(predicted_quality_grade = 'REJECT') * 100.0 / count(), 1) FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "displayName": "Non Conforme",
          "color": { "fixedColor": "red", "mode": "fixed" },
          "thresholds": { "steps": [{ "color": "red", "value": null }] }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "gauge",
      "title": "üéØ Confiance Moyenne",
      "description": "Niveau de confiance moyen du classificateur. Plus la valeur est √©lev√©e, plus le mod√®le est certain de ses pr√©dictions. Objectif: >80%",
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 33 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(confidence) * 100, 1) FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 60 },
              { "color": "green", "value": 80 }
            ]
          }
        }
      },
      "options": { "orientation": "auto", "showThresholdLabels": false, "showThresholdMarkers": true }
    },
    {
      "type": "table",
      "title": "üìã Derni√®res Classifications de Qualit√©",
      "description": "Historique des classifications avec d√©tails des param√®tres d'entr√©e: score sant√©, temp√©rature, VPD, DLI, EC et jours depuis plantation.",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 37 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT timestamp as Heure, batch_id as Lot, toString(predicted_quality_grade) as Grade, round(health_score_input, 1) as Score_Sante, round(air_temp, 1) as Temp_C, round(vpd, 2) as VPD, round(dli, 1) as DLI, round(ec, 2) as EC, days_since_planting as Jours, round(confidence * 100, 0) as Confiance FROM vertiflow.quality_classifications ORDER BY timestamp DESC LIMIT 15",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "align": "center" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Grade" }, "properties": [{ "id": "mappings", "value": [{ "type": "value", "options": { "PREMIUM": { "color": "green", "text": "üèÜ PREMIUM" }, "STANDARD": { "color": "yellow", "text": "üì¶ STANDARD" }, "REJECT": { "color": "red", "text": "‚ö†Ô∏è REJECT" } } }] }] },
          { "matcher": { "id": "byName", "options": "Confiance" }, "properties": [{ "id": "unit", "value": "percent" }] },
          { "matcher": { "id": "byName", "options": "Score_Sante" }, "properties": [{ "id": "unit", "value": "percent" }] }
        ]
      },
      "options": { "showHeader": true, "footer": { "show": false } }
    },
    {
      "type": "timeseries",
      "title": "üìà √âvolution de la Qualit√© dans le Temps",
      "description": "Tendance des classifications sur 7 jours. Permet d'identifier les p√©riodes probl√©matiques et de corr√©ler avec les conditions environnementales.",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 37 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT toStartOfHour(timestamp) as time, countIf(predicted_quality_grade = 'PREMIUM') as Premium, countIf(predicted_quality_grade = 'STANDARD') as Standard, countIf(predicted_quality_grade = 'REJECT') as Rejet FROM vertiflow.quality_classifications WHERE timestamp >= now() - INTERVAL 7 DAY GROUP BY time ORDER BY time",
          "refId": "A",
          "format": 0
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "lineWidth": 2, "fillOpacity": 40, "stacking": { "mode": "normal" } }
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Premium" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Standard" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Rejet" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum", "mean"] }
      }
    },
    {
      "type": "row",
      "title": "üß¨ A11 - CORTEX : Optimisation des Recettes (L-BFGS-B)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 45 },
      "collapsed": false
    },
    {
      "type": "text",
      "title": "‚öôÔ∏è Algorithme d'Optimisation",
      "description": "Explication de l'optimiseur Cortex A11",
      "gridPos": { "h": 5, "w": 8, "x": 0, "y": 46 },
      "options": {
        "mode": "markdown",
        "content": "### Scipy L-BFGS-B (Byrd et al. 1995)\n\nOptimise simultan√©ment 4 param√®tres sous contraintes:\n\n| Param√®tre | Min | Max | Unit√© |\n|-----------|-----|-----|-------|\n| **EC** | 1.0 | 2.5 | mS/cm |\n| **pH** | 5.5 | 6.5 | - |\n| **Temp√©rature** | 18 | 28 | ¬∞C |\n| **DLI** | 12 | 20 | mol/m¬≤/j |\n\n**Objectif**: Maximiser `predicted_yield`"
      }
    },
    {
      "type": "stat",
      "title": "üíä Score Sant√© Moyen",
      "description": "Score de sant√© global des cultures sur 24h. Indicateur composite bas√© sur les conditions environnementales. Objectif: >85%",
      "gridPos": { "h": 5, "w": 4, "x": 8, "y": 46 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(health_score), 1) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "displayName": "Sant√© Globale",
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 70 },
              { "color": "green", "value": 85 }
            ]
          }
        }
      },
      "options": { "colorMode": "value", "graphMode": "area" }
    },
    {
      "type": "gauge",
      "title": "üîç Confiance Anomalie",
      "description": "Score de confiance de d√©tection d'anomalies. Valeur √©lev√©e = anomalie d√©tect√©e avec certitude. Surveiller si >60%.",
      "gridPos": { "h": 5, "w": 4, "x": 12, "y": 46 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(anomaly_confidence_score) * 100, 1) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 40 },
              { "color": "orange", "value": 60 },
              { "color": "red", "value": 80 }
            ]
          }
        }
      },
      "options": { "orientation": "auto", "showThresholdLabels": true, "showThresholdMarkers": true }
    },
    {
      "type": "gauge",
      "title": "üîß Int√©grit√© Module",
      "description": "Score d'int√©grit√© des modules de culture. Indique l'√©tat de fonctionnement des √©quipements (capteurs, actuateurs). Alerte si <90%.",
      "gridPos": { "h": 5, "w": 4, "x": 16, "y": 46 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(module_integrity_score), 1) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 80 },
              { "color": "green", "value": 90 }
            ]
          }
        }
      },
      "options": { "orientation": "auto", "showThresholdLabels": false, "showThresholdMarkers": true }
    },
    {
      "type": "stat",
      "title": "üö® Urgence Maintenance",
      "description": "Score d'urgence de maintenance. Valeur √©lev√©e = intervention requise rapidement. Seuils: <30% (OK), 30-60% (Planifier), >60% (Urgent).",
      "gridPos": { "h": 5, "w": 4, "x": 20, "y": 46 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT round(avg(maintenance_urgency_score), 1) FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "displayName": "Urgence",
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 30 },
              { "color": "red", "value": 60 }
            ]
          }
        }
      },
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "type": "timeseries",
      "title": "üìä √âvolution des Indicateurs de Performance",
      "description": "Suivi temporel des KPIs: sant√©, anomalies, int√©grit√© et rendement scal√©. Permet de corr√©ler les variations et identifier les causes racines.",
      "gridPos": { "h": 8, "w": 16, "x": 0, "y": 51 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT toStartOfHour(timestamp) as time, round(avg(health_score), 1) as Sante, round(avg(anomaly_confidence_score) * 100, 1) as Anomalie, round(avg(module_integrity_score), 1) as Integrite, round(avg(predicted_yield_kg_m2) * 25, 1) as Rendement_x25 FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 7 DAY GROUP BY time ORDER BY time",
          "refId": "A",
          "format": 0
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "custom": { "lineWidth": 2, "fillOpacity": 10 }
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Sante" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Anomalie" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Integrite" }, "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Rendement_x25" }, "properties": [{ "id": "color", "value": { "fixedColor": "purple", "mode": "fixed" } }] }
        ]
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "min", "max"] }
      }
    },
    {
      "type": "table",
      "title": "üìã Derni√®res Donn√©es par Lot",
      "description": "Vue consolid√©e des derni√®res mesures et pr√©dictions par lot de culture.",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 51 },
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
      "targets": [
        {
          "rawSql": "SELECT batch_id as Lot, max(timestamp) as Derniere_MAJ, round(avg(predicted_yield_kg_m2), 2) as Rendement, any(quality_grade_prediction) as Qualite, round(avg(health_score), 0) as Sante, round(avg(anomaly_confidence_score), 2) as Anomalie FROM vertiflow.basil_ultimate_realtime WHERE timestamp >= now() - INTERVAL 24 HOUR GROUP BY batch_id ORDER BY Derniere_MAJ DESC LIMIT 10",
          "refId": "A",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "align": "center" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Rendement" }, "properties": [{ "id": "unit", "value": "kg/m¬≤" }] },
          { "matcher": { "id": "byName", "options": "Sante" }, "properties": [{ "id": "unit", "value": "percent" }] },
          { "matcher": { "id": "byName", "options": "Anomalie" }, "properties": [{ "id": "custom.cellOptions", "value": { "type": "color-background", "mode": "gradient" } }, { "id": "thresholds", "value": { "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 0.5 }] } }] }
        ]
      },
      "options": { "showHeader": true }
    },
    {
      "type": "row",
      "title": "üìñ Documentation et R√©f√©rences Scientifiques",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 59 },
      "collapsed": false
    },
    {
      "type": "text",
      "title": "üìö R√©f√©rences Bibliographiques",
      "gridPos": { "h": 6, "w": 24, "x": 0, "y": 60 },
      "options": {
        "mode": "markdown",
        "content": "### R√©f√©rences Scientifiques des Mod√®les VertiFlow\n\n| Mod√®le | M√©thode | R√©f√©rence |\n|--------|---------|----------|\n| **A9 Oracle** | Random Forest | Breiman, L. (2001). Random Forests. *Machine Learning*, 45(1), 5-32. |\n| **A9b Harvest** | Growing Degree Days | McMaster, G.S., & Wilhelm, W.W. (1997). Growing degree-days: one equation, two interpretations. *Agricultural and Forest Meteorology*, 87(4), 291-300. |\n| **A9b Harvest** | Mod√®le Gompertz | Zwietering, M.H., et al. (1990). Modeling of the bacterial growth curve. *Applied and Environmental Microbiology*, 56(6), 1875-1881. |\n| **A9b Harvest** | VPD (Tetens) | Tetens, O. (1930). √úber einige meteorologische Begriffe. *Zeitschrift f√ºr Geophysik*, 6, 297-309. |\n| **A9b Harvest** | DLI Optimal | Faust, J.E., & Logan, J. (2018). Daily Light Integral: A Research Review and High-resolution Maps. *HortScience*, 53(9), 1250-1257. |\n| **A10 Classifier** | Gradient Boosting | Friedman, J.H. (2001). Greedy function approximation: A gradient boosting machine. *Annals of Statistics*, 29(5), 1189-1232. |\n| **A11 Cortex** | L-BFGS-B | Byrd, R.H., et al. (1995). A limited memory algorithm for bound constrained optimization. *SIAM Journal on Scientific Computing*, 16(5), 1190-1208. |\n\n---\n**VertiFlow‚Ñ¢ Data Platform** | Version 2.0 | Derni√®re mise √† jour: 2026-02-05"
      }
    }
  ],
  "refresh": "30s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["vertiflow", "ml", "ia", "predictions", "oracle", "harvest", "classifier", "cortex", "gdd", "gompertz"],
  "templating": {
    "list": [
      {
        "name": "zone",
        "label": "Zone de Culture",
        "type": "query",
        "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
        "query": "SELECT DISTINCT zone FROM vertiflow.harvest_predictions ORDER BY zone",
        "refresh": 2,
        "multi": true,
        "includeAll": true,
        "current": { "selected": true, "text": "All", "value": "$__all" }
      },
      {
        "name": "batch_id",
        "label": "Lot de Culture",
        "type": "query",
        "datasource": { "type": "grafana-clickhouse-datasource", "uid": "aeb1b4ee-1f88-42c3-a35a-f594cac90e00" },
        "query": "SELECT DISTINCT batch_id FROM vertiflow.basil_ultimate_realtime ORDER BY batch_id",
        "refresh": 2,
        "multi": true,
        "includeAll": true,
        "current": { "selected": true, "text": "All", "value": "$__all" }
      }
    ]
  },
  "time": { "from": "now-24h", "to": "now" },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m"],
    "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d"]
  },
  "timezone": "browser",
  "title": "08 - Intelligence Artificielle VertiFlow",
  "uid": "vertiflow-ml-predictions-v2",
  "version": 1
}
