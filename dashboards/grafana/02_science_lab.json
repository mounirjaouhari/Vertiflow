/*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               VERTIFLOW - SCIENCE LAB ANALYTICAL DASHBOARD                   â•‘
â•‘        ML Models, Bio-Physics Simulation, and Optimization Analysis           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOCUMENT METADATA                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reference: TICKET-120                                                        â”‚
â”‚ Date: January 3, 2026                                                        â”‚
â”‚ Version: 1.0.0                                                               â”‚
â”‚ Author/Team: @Asama (Biologist & Quality), @Mounir (ML & Architecture)      â”‚
â”‚ Classification: Technical - Internal                                         â”‚
â”‚ Status: Production                                                           â”‚
â”‚ Last Modified: 2026-01-03                                                    â”‚
â”‚                                                                              â”‚
â”‚ PURPOSE:                                                                     â”‚
â”‚ This Grafana dashboard provides deep analytical insights for scientists,    â”‚
â”‚ agronomists, and ML engineers. It integrates:                               â”‚
â”‚ - ML model performance metrics (Oracle, Classifier, Nervous System)          â”‚
â”‚ - Bio-physics simulation validation (Farquhar, Penman-Monteith)            â”‚
â”‚ - Optimization analysis (Cortex PSO/Scipy algorithms)                       â”‚
â”‚ - Parameter sensitivity analysis                                            â”‚
â”‚ - Feedback loop quality and model drift detection                           â”‚
â”‚ - External data correlation (weather, market, soil)                         â”‚
â”‚                                                                              â”‚
â”‚ KEY INSIGHTS ENABLED:                                                        â”‚
â”‚ 1. Are our ML models accurate? (Prediction vs Reality)                       â”‚
â”‚ 2. Which parameters drive yield/quality most?                               â”‚
â”‚ 3. What's the optimal environment for each crop stage?                      â”‚
â”‚ 4. How well does physics model match reality?                               â”‚
â”‚ 5. Are we detecting pests/diseases early?                                   â”‚
â”‚ 6. What improvements can we make to current algorithms?                     â”‚
â”‚                                                                              â”‚
â”‚ DESIGNED FOR:                                                                â”‚
â”‚ - Data Scientists: Model performance, feature importance                     â”‚
â”‚ - Agronomists: Biological parameters, growth curves, stress responses        â”‚
â”‚ - Engineers: Algorithm optimization, parameter sensitivity                   â”‚
â”‚ - Quality Team: Classification accuracy, defect correlations                â”‚
â”‚                                                                              â”‚
â”‚ ASSIGNED TO: @Asama (Biology), @Mounir (ML Engineering)                     â”‚
â”‚ TEAM: @Asama, @Mounir, @Mouhammed (data), @Imrane (infrastructure)          â”‚
â”‚ TICKET: TICKET-120                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 1,
  "id": null,
  "links": [
    {
      "asDropdown": false,
      "icon": "dashboard",
      "includeVars": false,
      "keepTime": true,
      "tags": ["vertiflow", "operational"],
      "targetBlank": true,
      "title": "Operational Cockpit",
      "tooltip": "Real-time operations and environmental monitoring",
      "type": "dashboards",
      "url": "/d/operational-cockpit"
    },
    {
      "asDropdown": false,
      "icon": "doc",
      "includeVars": false,
      "keepTime": true,
      "tags": ["vertiflow", "finance"],
      "targetBlank": true,
      "title": "Executive Finance",
      "tooltip": "Business metrics and financial performance",
      "type": "dashboards",
      "url": "/d/executive-finance"
    }
  ],
  "panels": [
    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 1: ML MODEL PERFORMANCE OVERVIEW                           â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Monitor accuracy of all VertiFlow ML models              â•‘
    â•‘ Data Source: MongoDB.ml_metrics (feedback loop updates)           â•‘
    â•‘ Update Interval: 1 hour (batch model validation)                 â•‘
    â•‘ Visualization: Status cards with trend arrows                    â•‘
    â•‘                                                                   â•‘
    â•‘ Models Tracked:                                                   â•‘
    â•‘ 1. Oracle (RandomForest)                                         â•‘
    â•‘    - Purpose: Predict yield (kg/mÂ²) and harvest date            â•‘
    â•‘    - Metric: RMSE (kg/mÂ²) - Target: <0.5 kg/mÂ²                  â•‘
    â•‘    - RÂ² Score - Target: >0.92                                    â•‘
    â•‘                                                                   â•‘
    â•‘ 2. Classifier (Quality Assessment)                               â•‘
    â•‘    - Purpose: Grade product (PREMIUM/A/B/REJECT)                â•‘
    â•‘    - Metric: F1-Score - Target: >0.95                           â•‘
    â•‘    - Accuracy - Target: >96%                                     â•‘
    â•‘                                                                   â•‘
    â•‘ 3. Nervous System (LSTM)                                         â•‘
    â•‘    - Purpose: Forecast harvest date (days)                       â•‘
    â•‘    - Metric: MAE (days) - Target: <3 days error                 â•‘
    â•‘    - MAPE - Target: <8%                                         â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Scientists need to validate that models are performing      â•‘
    â•‘      well. Accuracy degradation signals need for retraining.    â•‘
    â•‘      Trends show if models are improving or drifting.           â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "ClickHouse",
      "description": "Real-time performance metrics for all VertiFlow ML models",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "max": 1,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 0.85
              },
              {
                "color": "green",
                "value": 0.92
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "fields": "",
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {},
        "textMode": "auto"
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "format": "table",
          "queryType": "randomWalk",
          "refId": "A",
          "datasource": "ClickHouse",
          "rawSql": "SELECT\n  model_name,\n  model_version,\n  ROUND(r2_score, 4) as r2_score,\n  ROUND(rmse, 4) as rmse,\n  ROUND(mae, 4) as mae,\n  ROUND(accuracy, 4) as accuracy,\n  test_count,\n  last_update\nFROM ml_models.model_performance\nWHERE evaluation_date >= today() - 7\nORDER BY last_update DESC\nLIMIT 10"
        }
      ],
      "title": "ğŸ¤– ML MODEL PERFORMANCE DASHBOARD",
      "type": "stat"
    },

    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 2: PHOTOSYNTHESIS MODEL VALIDATION                         â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Validate Farquhar model vs measured plant response       â•‘
    â•‘ Data Source: ClickHouse.photosynthesis_comparison                â•‘
    â•‘ Update Interval: Daily (leaf chamber measurements)                â•‘
    â•‘ Visualization: Scatter plot with regression line                 â•‘
    â•‘                                                                   â•‘
    â•‘ Shows:                                                            â•‘
    â•‘ - X-axis: Predicted photosynthesis rate (Âµmol CO2/mÂ²/s)         â•‘
    â•‘ - Y-axis: Measured photosynthesis rate (from leaf chamber)       â•‘
    â•‘ - Each point: Individual measurement                             â•‘
    â•‘ - Red line: Perfect prediction (Y=X)                             â•‘
    â•‘ - Blue line: Actual model fit                                    â•‘
    â•‘ - RMSE: Root mean square error in predictions                    â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Photosynthesis drives growth. If model doesn't match        â•‘
    â•‘      reality, our growth predictions (via Oracle) will be wrong. â•‘
    â•‘      Model bias indicates need for parameter recalibration.      â•‘
    â•‘                                                                   â•‘
    â•‘ References: Farquhar et al. (1980) model implementation          â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "ClickHouse",
      "description": "Validation of Farquhar photosynthesis model against measured data",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Measured Pn (Âµmol/mÂ²/s)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "points",
            "fillOpacity": 50,
            "gradientMode": "none",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "always",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "max": null,
          "min": null,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 8
      },
      "id": 2,
      "options": {
        "legend": {
          "calcs": ["mean", "max"],
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "vertiflow_photosynthesis_prediction_accuracy",
          "legendFormat": "Model Prediction vs Reality",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "title": "ğŸŒ¿ PHOTOSYNTHESIS MODEL VALIDATION",
      "type": "timeseries"
    },

    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 3: PARAMETER SENSITIVITY ANALYSIS                          â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Show impact of each environmental parameter on yield     â•‘
    â•‘ Data Source: ClickHouse.sensitivity_analysis                     â•‘
    â•‘ Update Interval: Weekly (computed from simulation runs)           â•‘
    â•‘ Visualization: Horizontal bar chart (elasticity coefficients)     â•‘
    â•‘                                                                   â•‘
    â•‘ Shows:                                                            â•‘
    â•‘ - How much does 1% change in parameter affect yield?             â•‘
    â•‘ - Temperature: ~2.5% yield change per 1Â°C                       â•‘
    â•‘ - Light: ~3.2% yield change per 100 Âµmol/mÂ²/s                   â•‘
    â•‘ - CO2: ~1.8% yield change per 100 ppm                           â•‘
    â•‘ - Nitrogen: ~2.1% yield change per 50 ppm                       â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Helps agronomists prioritize which parameter to optimize.   â•‘
    â•‘      High sensitivity = maximize control precision                â•‘
    â•‘      Low sensitivity = acceptable wider range                    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "ClickHouse",
      "description": "Parameter elasticity: yield impact per 1% parameter change",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "color-background",
            "filterable": false
          },
          "mappings": [],
          "max": 5,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              },
              {
                "color": "yellow",
                "value": 2
              },
              {
                "color": "orange",
                "value": 3
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "id": 3,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "fields": "",
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {},
        "textMode": "auto"
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "format": "table",
          "queryType": "randomWalk",
          "refId": "A",
          "datasource": "ClickHouse",
          "rawSql": "SELECT\n  parameter_name,\n  crop_type,\n  ROUND(elasticity_coefficient, 3) as sensitivity,\n  interpretation\nFROM analysis.parameter_sensitivity\nWHERE crop_type = '$crop'\nORDER BY elasticity_coefficient DESC"
        }
      ],
      "title": "ğŸ“ˆ PARAMETER SENSITIVITY (Elasticity)",
      "type": "barchart"
    },

    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 4: NUTRIENT UPTAKE ANALYSIS                                â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Correlate nutrient concentration with growth metrics     â•‘
    â•‘ Data Source: ClickHouse.nutrient_uptake_correlation              â•‘
    â•‘ Update Interval: Daily (nutrient dosing data)                    â•‘
    â•‘ Visualization: Heatmap (nutrient vs growth indicator correlation) â•‘
    â•‘                                                                   â•‘
    â•‘ Shows:                                                            â•‘
    â•‘ - Rows: Nutrients (N, P, K, Ca, Mg, etc.)                        â•‘
    â•‘ - Cols: Growth indicators (height, leaf area, biomass, yield)    â•‘
    â•‘ - Color: Correlation strength (-1 to +1)                         â•‘
    â•‘ - Red: Strong positive correlation                               â•‘
    â•‘ - Blue: Strong negative correlation                              â•‘
    â•‘ - White: No correlation                                          â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Identify which nutrients are limiting growth. If N shows    â•‘
    â•‘      weak correlation with yield despite high dosing, suggests   â•‘
    â•‘      N not limiting (check P, K, or micronutrients).            â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "ClickHouse",
      "description": "Nutrient concentration vs growth metric correlations",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            }
          },
          "mappings": [],
          "max": 1,
          "min": -1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": -1
              },
              {
                "color": "cyan",
                "value": -0.5
              },
              {
                "color": "white",
                "value": 0
              },
              {
                "color": "orange",
                "value": 0.5
              },
              {
                "color": "red",
                "value": 0.8
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 17
      },
      "id": 4,
      "options": {
        "calculate": false,
        "cellGap": 2,
        "cellRadius": 2,
        "color": {
          "scheme": "RdBu"
        },
        "exemplars": {
          "color": "rgba(255,0,255,0.7)"
        },
        "filterValues": {
          "le": 1e-5
        },
        "legend": {
          "show": true
        },
        "tooltip": {
          "show": true
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "format": "heatmap-bucket",
          "queryType": "randomWalk",
          "refId": "A",
          "datasource": "ClickHouse",
          "rawSql": "SELECT\n  nutrient_element,\n  growth_metric,\n  ROUND(correlation_coefficient, 3) as correlation\nFROM analysis.nutrient_growth_correlation\nWHERE crop_type = '$crop'\n  AND analysis_date >= today() - 30"
        }
      ],
      "title": "ğŸ§ª NUTRIENT UPTAKE CORRELATION ANALYSIS",
      "type": "heatmap"
    },

    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 5: PEST/DISEASE RISK PREDICTION                            â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Show predicted pest/disease risk based on conditions     â•‘
    â•‘ Data Source: ClickHouse.pest_risk_assessment                     â•‘
    â•‘ Update Interval: 6 hours (temperature/humidity driven)            â•‘
    â•‘ Visualization: Gauge charts (risk level 0-100)                   â•‘
    â•‘                                                                   â•‘
    â•‘ Risk Factors Monitored:                                           â•‘
    â•‘ - Botrytis risk: High humidity + low air flow â†’ Spore germinationâ•‘
    â•‘   Optimal: <85% RH, air speed >0.3 m/s                           â•‘
    â•‘                                                                   â•‘
    â•‘ - Powdery Mildew: Temp 18-26Â°C + humidity 40-90%                â•‘
    â•‘   Prevention: Keep <70% RH, increase air circulation              â•‘
    â•‘                                                                   â•‘
    â•‘ - Root Rot (Pythium): Cold + wet roots                           â•‘
    â•‘   Prevention: Root zone >18Â°C, maintain DO >6 mg/L                â•‘
    â•‘                                                                   â•‘
    â•‘ - Spider Mites: Low humidity + high temp                         â•‘
    â•‘   Prevention: Humidity >50%, mist canopy                          â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Early warning allows preventive action (cultural control)   â•‘
    â•‘      vs expensive treatment (biocontrols, chemicals) post-outbreakâ•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "ClickHouse",
      "description": "Predicted pest/disease risk levels based on environmental conditions",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "options": {
                "1": {
                  "color": "green",
                  "index": 0,
                  "text": "LOW"
                },
                "2": {
                  "color": "yellow",
                  "index": 1,
                  "text": "MODERATE"
                },
                "3": {
                  "color": "orange",
                  "index": 2,
                  "text": "HIGH"
                },
                "4": {
                  "color": "red",
                  "index": 3,
                  "text": "CRITICAL"
                }
              },
              "type": "value"
            }
          ],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 30
              },
              {
                "color": "orange",
                "value": 60
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 17
      },
      "id": 5,
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "fields": "",
          "calcs": [
            "lastNotNull"
          ]
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "text": {}
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "format": "table",
          "queryType": "randomWalk",
          "refId": "A",
          "datasource": "ClickHouse",
          "rawSql": "SELECT\n  pest_disease_name,\n  risk_level_percent,\n  primary_trigger,\n  recommendation,\n  prediction_confidence\nFROM analysis.pest_disease_risk\nWHERE facility_id = '$facility'\n  AND prediction_timestamp >= now() - INTERVAL 6 HOUR\nORDER BY risk_level_percent DESC"
        }
      ],
      "title": "ğŸ› PEST/DISEASE RISK PREDICTION",
      "type": "gauge"
    },

    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 6: CORTEX OPTIMIZATION PERFORMANCE                         â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Show performance of optimization algorithms (PSO, Scipy) â•‘
    â•‘ Data Source: MongoDB.optimization_runs                           â•‘
    â•‘ Update Interval: Daily (overnight optimization batch)            â•‘
    â•‘ Visualization: Line chart (convergence curves)                   â•‘
    â•‘                                                                   â•‘
    â•‘ Shows:                                                            â•‘
    â•‘ - Objective: Maximize yield Ã— quality - costs                    â•‘
    â•‘ - Algorithm: Particle Swarm Optimization (PSO)                   â•‘
    â•‘ - Iterations: 100 (per day)                                      â•‘
    â•‘ - Convergence: How quickly does optimizer find good solution?    â•‘
    â•‘ - Best parameters: Recommended setpoints for tomorrow            â•‘
    â•‘                                                                   â•‘
    â•‘ Metrics:                                                          â•‘
    â•‘ - Objective value progression                                    â•‘
    â•‘ - Diversity (swarm spread)                                       â•‘
    â•‘ - Convergence rate                                               â•‘
    â•‘ - Constraint violations (if any)                                 â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Engineers need to ensure optimization is working correctly. â•‘
    â•‘      If convergence is slow or objective not improving, might    â•‘
    â•‘      need algorithm tuning or more computational resources.      â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "MongoDB",
      "description": "Convergence performance of Cortex optimization algorithms",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Objective Value (Revenue-Costs)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "max": null,
          "min": null,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 25
      },
      "id": 6,
      "options": {
        "legend": {
          "calcs": ["mean", "max"],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "vertiflow_cortex_optimization_convergence",
          "legendFormat": "Objective Value Progression",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "title": "ğŸ¯ CORTEX OPTIMIZATION CONVERGENCE ANALYSIS",
      "type": "timeseries"
    },

    /*
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PANEL 7: QUALITY DEFECT ROOT CAUSE ANALYSIS                      â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ Purpose: Correlate quality defects with environmental factors     â•‘
    â•‘ Data Source: ClickHouse.quality_defect_analysis                  â•‘
    â•‘ Update Interval: Weekly (post-harvest aggregation)               â•‘
    â•‘ Visualization: Sankey diagram (environment â†’ defect type)         â•‘
    â•‘                                                                   â•‘
    â•‘ Defect Categories:                                                â•‘
    â•‘ - Yellowing (chlorosis): Low N, Fe, or Mg                        â•‘
    â•‘ - Purple coloring: High P/K ratio or cold stress                 â•‘
    â•‘ - Spots (necrosis): Ca deficiency, high salinity                 â•‘
    â•‘ - Wilting: Insufficient water availability                       â•‘
    â•‘ - Bolting: Early flowering from temperature stress                â•‘
    â•‘ - Small leaves: Insufficient light or nutrients                   â•‘
    â•‘                                                                   â•‘
    â•‘ Root Cause Mapping:                                               â•‘
    â•‘ Each defect flows from likely environmental cause                â•‘
    â•‘ Width of flow = frequency of that cause-effect pair              â•‘
    â•‘                                                                   â•‘
    â•‘ Why: Helps quality team and agronomists identify systematic      â•‘
    â•‘      problems (all lettuce yellowing = check Fe availability)    â•‘
    â•‘      vs isolated issues (one plant wilting = check watering)     â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    {
      "datasource": "ClickHouse",
      "description": "Quality defect root cause analysis (Sankey: environment â†’ defect)",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            }
          },
          "mappings": [],
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 33
      },
      "id": 7,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "format": "table",
          "queryType": "randomWalk",
          "refId": "A",
          "datasource": "ClickHouse",
          "rawSql": "SELECT\n  environmental_factor,\n  defect_type,\n  COUNT(*) as frequency,\n  ROUND(100 * COUNT(*) / SUM(COUNT(*)) OVER(), 1) as percentage\nFROM analysis.quality_defect_root_cause\nWHERE crop_type = '$crop'\n  AND assessment_date >= today() - 30\nGROUP BY environmental_factor, defect_type\nHAVING frequency >= 5\nORDER BY frequency DESC"
        }
      ],
      "title": "ğŸ” QUALITY DEFECT ROOT CAUSE ANALYSIS",
      "type": "nodeGraph"
    }
  ],
  "refresh": "1h",
  "schemaVersion": 35,
  "style": "dark",
  "tags": ["vertiflow", "analytics", "ml", "science", "optimization"],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "OCIM-BASI",
          "value": "OCIM-BASI"
        },
        "datasource": "ClickHouse",
        "definition": "SELECT DISTINCT crop_type FROM analysis.parameter_sensitivity ORDER BY crop_type",
        "description": null,
        "error": null,
        "hide": 0,
        "includeAll": false,
        "label": "Crop Type",
        "multi": false,
        "name": "crop",
        "options": [],
        "query": {
          "query": "SELECT DISTINCT crop_type FROM analysis.parameter_sensitivity ORDER BY crop_type",
          "rawSql": "SELECT DISTINCT crop_type FROM analysis.parameter_sensitivity ORDER BY crop_type"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tagsQuery": "",
        "type": "query"
      },
      {
        "current": {
          "selected": false,
          "text": "FAC-001",
          "value": "FAC-001"
        },
        "datasource": "ClickHouse",
        "definition": "SELECT DISTINCT facility_id FROM telemetry.facility_summary ORDER BY facility_id",
        "description": null,
        "error": null,
        "hide": 0,
        "includeAll": false,
        "label": "Facility",
        "multi": false,
        "name": "facility",
        "options": [],
        "query": {
          "query": "SELECT DISTINCT facility_id FROM telemetry.facility_summary ORDER BY facility_id",
          "rawSql": "SELECT DISTINCT facility_id FROM telemetry.facility_summary ORDER BY facility_id"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tagsQuery": "",
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["1m", "5m", "15m", "30m", "1h", "2h", "1d"]
  },
  "timezone": "UTC",
  "title": "VertiFlow Science Lab Analytics",
  "uid": "science-lab-dashboard",
  "version": 1
}

/*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            IMPLEMENTATION NOTES                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘ INSTALLATION:                                                                â•‘
â”‚ 1. Save this file as: dashboards/grafana/02_science_lab.json               â•‘
â•‘ 2. Import to Grafana: Home â†’ Dashboards â†’ Import â†’ Paste JSON               â•‘
â•‘ 3. Select data sources:                                                      â•‘
â•‘    - Prometheus: For ML model metrics                                        â•‘
â•‘    - ClickHouse: For scientific analyses (photosynthesis, nutrients, etc.)  â•‘
â•‘    - MongoDB: For optimization run history                                   â•‘
â•‘                                                                              â•‘
â•‘ DATA DEPENDENCIES:                                                           â•‘
â•‘ 1. ML Model Performance Metrics                                              â•‘
â•‘    â”œâ”€ Source: Feedback loop evaluation (Oracle, Classifier, Nervous System) â•‘
â•‘    â”œâ”€ Update: Hourly (batch validation)                                     â•‘
â•‘    â””â”€ Tables: ml_models.model_performance, ml_models.prediction_errors      â•‘
â•‘                                                                              â•‘
â•‘ 2. Photosynthesis Validation Data                                            â•‘
â•‘    â”œâ”€ Source: Portable leaf chamber (lab equipment)                         â•‘
â•‘    â”œâ”€ Frequency: 2-3 measurements per week per facility                     â•‘
â•‘    â””â”€ Table: ClickHouse.photosynthesis_comparison                           â•‘
â•‘                                                                              â•‘
â•‘ 3. Sensitivity Analysis Results                                              â•‘
â•‘    â”œâ”€ Source: Monte Carlo simulation (Farquhar model)                       â•‘
â•‘    â”œâ”€ Frequency: Weekly overnight batch                                     â•‘
â•‘    â””â”€ Table: analysis.parameter_sensitivity                                 â•‘
â•‘                                                                              â•‘
â•‘ 4. Pest Risk Prediction                                                      â•‘
â•‘    â”œâ”€ Source: IPM decision support system                                    â•‘
â•‘    â”œâ”€ Update: 6-hourly (environment-triggered)                              â•‘
â•‘    â””â”€ Table: analysis.pest_disease_risk                                      â•‘
â•‘                                                                              â•‘
â•‘ 5. Optimization Results (Cortex)                                             â•‘
â•‘    â”œâ”€ Source: Daily PSO optimization runs                                    â•‘
â•‘    â”œâ”€ Time: Overnight (non-peak compute hours)                              â•‘
â•‘    â””â”€ Table: MongoDB.optimization_runs                                       â•‘
â•‘                                                                              â•‘
â•‘ RECOMMENDED ALERTS:                                                          â•‘
â•‘ 1. Model Accuracy Degradation: Alert if RÂ² drops >0.05 from baseline        â•‘
â•‘ 2. Photosynthesis Bias: Alert if RMSE >0.8 Âµmol/mÂ²/s                        â•‘
â•‘ 3. High Pest Risk: Alert if any pest risk >70%                               â•‘
â•‘ 4. Optimization Convergence: Alert if objective not improving after 50 iter  â•‘
â•‘ 5. Nutrient Imbalance: Alert if correlation <0.3 for key nutrients         â•‘
â•‘                                                                              â•‘
â•‘ REFRESH STRATEGY:                                                            â•‘
â•‘ - Overall dashboard: 1 hour (analytical data updates)                        â•‘
â•‘ - ML model performance: 1 hour (hourly validation batches)                   â•‘
â•‘ - Pest risk: 6 hours (environment-triggered, less frequently)                â•‘
â•‘ - Parameter sensitivity: 1 week (computationally intensive)                  â•‘
â•‘ - Optimization results: 1 day (overnight batch)                              â•‘
â•‘                                                                              â•‘
â•‘ USER ROLES & PERMISSIONS:                                                    â•‘
â•‘ - Scientists: Full access (read + edit annotations)                          â•‘
â•‘ - Agronomists: Read access (view-only)                                       â•‘
â•‘ - ML Engineers: Full access (modify analysis parameters)                     â•‘
â•‘ - Operations: Read access (informational only)                               â•‘
â•‘                                                                              â•‘
â•‘ TROUBLESHOOTING:                                                             â•‘
â•‘ - Missing ML metrics: Check feedback loop job logs                           â•‘
â•‘ - No photosynthesis data: Verify leaf chamber is operational                 â•‘
â•‘ - Sensitivity analysis delayed: Check if overnight batch queued              â•‘
â•‘ - Pest risk anomalies: Verify IPM model parameters match current crop        â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DOCUMENT FOOTER:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TICKET: TICKET-120
ASSIGNED TO: @Asama (Biologist & Quality Lead), @Mounir (ML & Architecture)
TEAM: @Asama (biology/quality), @Mounir (ML/optimization), 
      @Mouhammed (data engineering), @Imrane (infrastructure)

CONTACT FOR QUESTIONS:
- @Asama: Biological models, quality defects, pest management
- @Mounir: ML models, photosynthesis validation, optimization algorithms
- @Mouhammed: Data pipeline, ClickHouse schemas, query optimization
- @Imrane: Dashboard infrastructure, data source connectivity

PROJECT: VertiFlow Data Platform - Intelligent Vertical Farming
STATUS: Production Release
CLASSIFICATION: Technical - Internal
REPOSITORY: J-Mounir/test-projet-agri (GitHub)

LAST UPDATED: 2026-01-03
NEXT REVIEW: 2026-02-03 (Monthly)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/
