---
config:
  layout: elk
---
flowchart TB
    subgraph SOURCES["üì° 1. SOURCES"]
        IOT["üå± Capteurs IoT"]
        VISION["üì∑ Vision IA"]
        APIS["üõ∞Ô∏è APIs NASA/RTE"]
        LAB["üî¨ Saisie Labo"]
    end
    
    subgraph NIFI["üîÑ 2. APACHE NIFI"]
        N_NORM["üîÑ Normalisation"]
        N_ENRICH["‚ú® Enrichissement"]
        N_QUAL["üîê Tra√ßabilit√©"]
    end
    
    subgraph KAFKA["üì¨ 3. APACHE KAFKA"]
        K_TOPIC["üìä Topic Principal"]
    end
    
    subgraph STORAGE["üíæ 4. STOCKAGE"]
        MONGO[("‚ö° MongoDB - Temps R√©el")]
        CLICK[("üìà ClickHouse - Analytique")]
    end
    
    subgraph INTELLIGENCE["üß† 5. INTELLIGENCE"]
        ALGO_REFLEXE["üö® Algo R√©flexe"]
        ALGO_STAT["üìä Algo Statistique"]
        ALGO_PREDICT["ü§ñ Algo Pr√©dictif"]
    end
    
    subgraph VIZ["üìä 6. VISUALISATION"]
        PBI_LIVE["‚ö° Dashboard Live"]
        PBI_SCIENCE["üî¨ Rapport Science"]
    end
    
    %% CONNECTIONS
    IOT --> N_NORM
    VISION --> N_NORM
    APIS --> N_NORM
    LAB --> N_NORM
    N_NORM --> N_ENRICH
    N_ENRICH --> N_QUAL
    N_QUAL --> K_TOPIC
    K_TOPIC --> MONGO
    K_TOPIC --> CLICK
    K_TOPIC --> ALGO_PREDICT
    MONGO <--> ALGO_REFLEXE
    CLICK <--> ALGO_STAT
    ALGO_PREDICT -.->|Feedback| K_TOPIC
    MONGO --> PBI_LIVE
    K_TOPIC -->|Streaming| PBI_LIVE
    CLICK --> PBI_SCIENCE
    ALGO_REFLEXE -.->|Contr√¥le| IOT

    %% STYLES
    MONGO:::Class_Mongo
    CLICK:::Class_Click
    K_TOPIC:::Class_Kafka
    N_QUAL:::Class_NiFi
    
    classDef Class_Mongo fill:#00C853,stroke:#333,color:white
    classDef Class_Click fill:#FFD600,stroke:#333,color:black
    classDef Class_Kafka fill:#FF9800,stroke:#333,color:white
    classDef Class_NiFi fill:#03A9F4,stroke:#333,color:white
    
    linkStyle 6 stroke:#FF9800,stroke-width:4px
    linkStyle 7 stroke:#00C853,stroke-width:4px
    linkStyle 13 stroke:#D50000,stroke-width:3px,stroke-dasharray:5 5