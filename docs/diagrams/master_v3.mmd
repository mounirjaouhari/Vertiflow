graph TD
    %% ZONE 1 : SOURCES
    subgraph Z1 ["ðŸ“¡ ZONE 1 : SOURCES"]
        style Z1 fill:#eceff1,stroke:#455a64
        S_IOT["ðŸŒ± Capteurs IoT"]
        S_VIS["ðŸ“· Vision IA"]
        S_API["ðŸ›°ï¸ APIs Externes"]
        S_LAB["ðŸ”¬ Saisie Labo"]
    end

    %% ZONE 2 : NIFI
    subgraph Z2 ["ðŸ”„ ZONE 2 : APACHE NIFI"]
        style Z2 fill:#e3f2fd,stroke:#1565c0
        N1["ðŸ”„ Normalisation"]
        N2["âœ¨ Enrichissement"]
        N3["âœ… QualitÃ© Z-Score"]
        N4["ðŸ” TraÃ§abilitÃ©"]
        N_FAIL["ðŸ’¾ Dead Letter Queue"]
    end

    %% ZONE 3 : KAFKA
    subgraph Z3 ["ðŸ“¬ ZONE 3 : APACHE KAFKA"]
        style Z3 fill:#fff3e0,stroke:#ef6c00
        K_TOPIC["ðŸ“Š Topic Principal"]
        K_STREAM["âš¡ Stream Processing"]
    end

    %% ZONE 4 : MONGODB
    subgraph Z4 ["âš¡ ZONE 4 : MONGODB"]
        style Z4 fill:#e8f5e9,stroke:#2e7d32
        M_STATE[("ðŸ’¾ Ã‰tat Actuel")]
        A4["ðŸš¨ Seuillage"]
        A5["âš™ï¸ RÃ¨gles MÃ©tier"]
        A6["ðŸ”§ Maintenance"]
    end

    %% ZONE 5 : CLICKHOUSE & ML
    subgraph Z5 ["ðŸ§  ZONE 5 : ANALYTIQUE & ML"]
        style Z5 fill:#fff9c4,stroke:#fbc02d
        C_HIST[("ðŸ“ˆ Data Warehouse")]
        A7["ðŸ“Š Statistiques"]
        A8["ðŸ’° ROI Financier"]
        ML_ENG["ðŸ¤– Moteur ML"]
        A9["â³ LSTM"]
        A10["ðŸŒ³ Random Forest"]
    end

    %% ZONE 6 : POWER BI
    subgraph Z6 ["ðŸ“Š ZONE 6 : VISUALISATION"]
        style Z6 fill:#f3e5f5,stroke:#7b1fa2
        PBI_S["âš¡ Dashboard Temps RÃ©el"]
        PBI_D["ðŸ“ˆ Rapports Analytiques"]
    end

    %% CONNEXIONS
    S_IOT --> N1
    S_VIS --> N1
    S_API --> N1
    S_LAB --> N1
    
    N1 --> N2 --> N3 --> N4
    N3 -.->|Erreur| N_FAIL
    N4 --> K_TOPIC
    
    K_TOPIC --> M_STATE
    M_STATE <--> A4
    A4 --> A5 --> A6
    
    K_TOPIC --> C_HIST
    C_HIST <--> A7
    C_HIST <--> A8
    
    C_HIST --> ML_ENG
    ML_ENG --> A9
    ML_ENG --> A10
    A9 -.->|PrÃ©dictions| K_TOPIC
    A10 -.->|PrÃ©dictions| K_TOPIC
    
    K_TOPIC --> PBI_S
    C_HIST --> PBI_D
    A5 -.->|Action| S_IOT