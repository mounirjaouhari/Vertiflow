```mermaid
---
title: VertiFlow - DÃ©tail des Processeurs par Zone
---
flowchart TB
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% LÃ‰GENDE DES Ã‰TATS
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph LEGEND["ğŸ“‹ LÃ©gende"]
        direction LR
        L1["ğŸŸ¢ Running"]
        L2["ğŸ”´ Stopped"]
        L3["âšª Disabled"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ZONE 0 : EXTERNAL DATA APIs (9 processeurs - tous ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Z0["ğŸŒ ZONE 0 - External Data APIs (9 processeurs)"]
        direction LR
        
        subgraph Z0_W["Weather"]
            Z0_1["ğŸŸ¢ Trigger<br/>GenerateFlowFile"]
            Z0_2["ğŸŸ¢ API - Open-Meteo<br/>InvokeHTTP"]
            Z0_3["ğŸŸ¢ Publish Weather<br/>PublishKafka_2_6"]
        end
        
        subgraph Z0_A["Air Quality"]
            Z0_4["ğŸŸ¢ Trigger<br/>GenerateFlowFile"]
            Z0_5["ğŸŸ¢ API - OpenAQ<br/>InvokeHTTP"]
            Z0_6["ğŸŸ¢ Publish AirQuality<br/>PublishKafka_2_6"]
        end
        
        subgraph Z0_N["NASA"]
            Z0_7["ğŸŸ¢ Trigger<br/>GenerateFlowFile"]
            Z0_8["ğŸŸ¢ API - NASA POWER<br/>InvokeHTTP"]
            Z0_9["ğŸŸ¢ Publish NASA<br/>PublishKafka_2_6"]
        end
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ZONE 1 : INGESTION & VALIDATION (5 processeurs - tous ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Z1["ğŸ“¡ ZONE 1 - Ingestion & Validation (5 processeurs)"]
        direction TB
        Z1_1["ğŸŸ¢ A2 - ConsumeMQTT<br/>vertiflow/farm/#"]
        Z1_2["ğŸŸ¢ A1 - ListenHTTP<br/>REST API"]
        Z1_3["ğŸŸ¢ ConsumeKafkaRecord_2_6<br/>basil_telemetry_full"]
        Z1_4["ğŸŸ¢ ValidateRecord<br/>Schema Validation"]
        Z1_5["ğŸŸ¢ Monitor_Ingestion_Health<br/>MonitorActivity"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ZONE 2 : CONTEXTUALISATION (2 processeurs - tous ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Z2["ğŸ”„ ZONE 2 - Contextualisation (2 processeurs)"]
        direction LR
        Z2_1["ğŸŸ¢ B2 - ExecuteScript (VPD)<br/>Python VPD Calculation"]
        Z2_2["ğŸŸ¢ B4 - PublishKafka (Telemetry)<br/>PublishKafka_2_6"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ZONE 3 : PERSISTANCE (10 processeurs - tous ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Z3["ğŸ’¾ ZONE 3 - Persistance (10 processeurs)"]
        direction TB
        
        subgraph Z3_PREP["PrÃ©paration"]
            Z3_1["ğŸŸ¢ D1 - QueryRecord<br/>SQL Filtering"]
            Z3_2["ğŸŸ¢ UpdateRecord<br/>Field Updates"]
            Z3_3["ğŸŸ¢ M1 - MergeContent<br/>Batching"]
        end
        
        subgraph Z3_STORE["Stockage"]
            Z3_4["ğŸŸ¢ C1 - PutClickHouse<br/>PutDatabaseRecord JDBC"]
            Z3_5["ğŸŸ¢ C2 - PutMongo (Audit)<br/>MongoDB"]
            Z3_6["ğŸŸ¢ C3 - PutFile (Archive)<br/>Local Filesystem"]
            Z3_7["ğŸŸ¢ C4 - PutGCSObject<br/>Data Lake"]
            Z3_8["ğŸŸ¢ C5 - PutBigQueryBatch<br/>Analytics"]
        end
        
        subgraph Z3_RATE["Rate Limiting"]
            Z3_9["ğŸŸ¢ Rate Limit<br/>ControlRate x2"]
            Z3_10["ğŸŸ¢ Log Error<br/>LogAttribute x2"]
        end
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ZONE 4 : RÃ‰TROACTION (11 processeurs - tous ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Z4["ğŸ” ZONE 4 - RÃ©troaction (11 processeurs)"]
        direction TB
        
        subgraph Z4_DETECT["DÃ©tection Anomalies"]
            Z4_1["ğŸŸ¢ Z-Score Validator<br/>ExecuteScript"]
            Z4_2["ğŸŸ¢ D1 - QueryRecord x2<br/>Anomaly Detection"]
            Z4_3["ğŸŸ¢ EvaluateJsonPath<br/>Field Extraction"]
        end
        
        subgraph Z4_ACTION["Actions Correctives"]
            Z4_4["ğŸŸ¢ UpdateAttribute<br/>Metadata"]
            Z4_5["ğŸŸ¢ D2 - AttributesToJSON<br/>Build Payload"]
            Z4_6["ğŸŸ¢ B4 - PublishKafka<br/>Corrector Commands"]
            Z4_7["ğŸŸ¢ D3 - PublishMQTT<br/>IoT Commands"]
        end
        
        subgraph Z4_PERSIST["Persistance Feedback"]
            Z4_8["ğŸŸ¢ M1 - MergeContent<br/>Batching"]
            Z4_9["ğŸŸ¢ C4 - PutGCSObject<br/>Feedback Archive"]
            Z4_10["ğŸŸ¢ C2 - PutMongo<br/>Feedback Audit"]
        end
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ZONE 5 : STATIC DATA LOADERS (10 processeurs - tous ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Z5["ğŸ“ ZONE 5 - Static Data Loaders (10 processeurs)"]
        direction TB
        
        subgraph Z5_DS["Datasets CSV"]
            Z5_1["ğŸŸ¢ GetFile - Datasets CSV<br/>CSV Files"]
            Z5_2["ğŸŸ¢ ConvertRecord<br/>CSV to JSON"]
            Z5_3["ğŸŸ¢ Publish Datasets<br/>PublishKafka_2_6"]
        end
        
        subgraph Z5_LAB["Lab Data"]
            Z5_4["ğŸŸ¢ GetFile - Lab Data<br/>Lab Files"]
            Z5_5["ğŸŸ¢ ValidateRecord - Lab<br/>Schema Validation"]
            Z5_6["ğŸŸ¢ Publish Lab<br/>PublishKafka_2_6"]
        end
        
        subgraph Z5_OTHER["Recipes & Market"]
            Z5_7["ğŸŸ¢ GetFile - Recipes<br/>Recipe Files"]
            Z5_8["ğŸŸ¢ PutMongo - Recipes<br/>MongoDB"]
            Z5_9["ğŸŸ¢ ConsumeKafka - Scraped<br/>ConsumeKafka_2_6"]
            Z5_10["ğŸŸ¢ PutMongo - Market<br/>MongoDB"]
        end
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% DLQ (1 processeur - ğŸŸ¢)
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph DLQ["âš ï¸ DLQ - Dead Letter Queue (1 processeur)"]
        DLQ_1["ğŸŸ¢ DLQ_Logger<br/>LogMessage"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% CONNEXIONS INTER-ZONES
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Z0 --> Z1
    Z1 --> Z2
    Z2 --> Z3
    Z3 --> Z4
    Z5 --> Z1
    Z5 --> Z3
    Z1 -.-> DLQ
    Z4 -.->|"Feedback Loop"| Z1

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% STYLES
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    style LEGEND fill:#fafafa,stroke:#9e9e9e
    style Z0 fill:#e8eaf6,stroke:#3f51b5,stroke-width:3px
    style Z1 fill:#e3f2fd,stroke:#1565c0,stroke-width:3px
    style Z2 fill:#e8f5e9,stroke:#2e7d32,stroke-width:3px
    style Z3 fill:#fff3e0,stroke:#ef6c00,stroke-width:3px
    style Z4 fill:#fce4ec,stroke:#c2185b,stroke-width:3px
    style Z5 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style DLQ fill:#ffebee,stroke:#c62828,stroke-width:3px
    
    style Z3_PREP fill:#fff9c4,stroke:#fbc02d
    style Z3_STORE fill:#c8e6c9,stroke:#388e3c
    style Z3_RATE fill:#ffccbc,stroke:#e64a19
    
    style Z4_DETECT fill:#e1bee7,stroke:#8e24aa
    style Z4_ACTION fill:#b2dfdb,stroke:#00897b
    style Z4_PERSIST fill:#ffe0b2,stroke:#f57c00
```
